<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=MXVwpSGzOOhqOc5hUWJbBLizfYjsfH9XaeDpmRKYJN5bV0WvE1cEyAoIq5yYZlSc');.lst-kix_7452h7rq95ul-8>li:before{content:"\0025a0  "}ul.lst-kix_7452h7rq95ul-8{list-style-type:none}.lst-kix_7452h7rq95ul-4>li:before{content:"\0025cb  "}ul.lst-kix_7452h7rq95ul-7{list-style-type:none}ul.lst-kix_7452h7rq95ul-6{list-style-type:none}.lst-kix_7452h7rq95ul-3>li:before{content:"\0025cf  "}.lst-kix_7452h7rq95ul-1>li:before{content:"\0025cb  "}ul.lst-kix_7452h7rq95ul-1{list-style-type:none}ul.lst-kix_7452h7rq95ul-0{list-style-type:none}.lst-kix_7452h7rq95ul-0>li:before{content:"\0025cf  "}.lst-kix_7452h7rq95ul-2>li:before{content:"\0025a0  "}ul.lst-kix_7452h7rq95ul-5{list-style-type:none}ul.lst-kix_7452h7rq95ul-4{list-style-type:none}ul.lst-kix_7452h7rq95ul-3{list-style-type:none}ul.lst-kix_7452h7rq95ul-2{list-style-type:none}.lst-kix_7452h7rq95ul-5>li:before{content:"\0025a0  "}.lst-kix_7452h7rq95ul-6>li:before{content:"\0025cf  "}.lst-kix_7452h7rq95ul-7>li:before{content:"\0025cb  "}ol{margin:0;padding:0}table td,table th{padding:0}.c16{margin-left:-5pt;padding-top:7pt;padding-bottom:7pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left;margin-right:-5pt;height:11pt}.c19{-webkit-text-decoration-skip:none;color:#212121;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:13.5pt;font-family:"Roboto Mono";font-style:normal}.c21{margin-left:-5pt;padding-top:7pt;padding-bottom:7pt;line-height:1.4285714285714286;orphans:2;widows:2;text-align:left;margin-right:-5pt}.c9{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Roboto Mono";font-style:normal}.c6{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Roboto Mono";font-style:normal}.c10{-webkit-text-decoration-skip:none;font-weight:400;text-decoration:underline;text-decoration-skip-ink:none;font-size:12pt;font-family:"Roboto Mono"}.c51{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c28{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c7{padding-top:12pt;padding-bottom:12pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c35{padding-top:12pt;padding-bottom:12pt;line-height:1.0;orphans:2;widows:2;text-align:center}.c27{-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline;text-decoration-skip-ink:none;font-size:11pt}.c29{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c40{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:center}.c30{-webkit-text-decoration-skip:none;color:#212121;text-decoration:underline;text-decoration-skip-ink:none;font-size:13.5pt}.c1{font-size:10.5pt;font-family:"Roboto Mono";color:#37474f;font-weight:400}.c17{font-size:10.5pt;font-family:"Roboto Mono";color:#0d904f;font-weight:400}.c5{font-size:10.5pt;font-family:"Roboto Mono";color:#9c27b0;font-weight:400}.c11{text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c18{padding-top:24pt;padding-bottom:12pt;line-height:1.6666666666666667;text-align:left}.c4{font-size:10.5pt;font-family:"Roboto Mono";color:#3b78e7;font-weight:400}.c12{font-size:12pt;font-family:"Roboto Mono";color:#212121;font-weight:400}.c0{font-size:10.5pt;font-family:"Roboto Mono";color:#d81b60;font-weight:400}.c36{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c15{font-size:12pt;font-family:"Roboto Mono";font-weight:400}.c8{font-family:"Roboto Mono";color:#d81b60;font-weight:400}.c2{font-family:"Roboto Mono";color:#37474f;font-weight:400}.c13{text-decoration:none;vertical-align:baseline;font-style:normal}.c14{font-family:"Roboto Mono";color:#3b78e7;font-weight:400}.c42{-webkit-text-decoration-skip:none;text-decoration:underline;text-decoration-skip-ink:none}.c34{font-size:8.5pt;color:#0b5394}.c44{text-decoration:none;vertical-align:baseline}.c26{font-size:10.5pt;color:#1155cc}.c49{color:#757575;font-size:10.5pt}.c24{font-weight:400;font-family:"Roboto Mono"}.c52{font-weight:700;font-family:"Roboto Mono"}.c39{vertical-align:baseline;font-style:normal}.c3{color:inherit;text-decoration:inherit}.c50{font-weight:400;font-family:"Arial"}.c37{color:#039be5}.c25{color:#0d904f}.c23{color:#000000}.c22{color:#37474f}.c38{color:#1155cc}.c41{color:#073763}.c32{color:#9c27b0}.c45{font-size:11pt}.c43{font-size:10pt}.c33{font-style:italic}.c47{font-size:14pt}.c31{font-size:16pt}.c46{font-size:8.5pt}.c48{font-size:18pt}.c20{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c36"><div><p class="c20 c28"><span class="c13 c50 c23 c45"></span></p></div><h2 class="c40" id="h.b4982t38mg34"><span class="c42 c24">Setting up Google Login for Friendly Panda:<br><br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 127.50px; height: 127.50px;"><img alt="" src="images/image2.png" style="width: 127.50px; height: 127.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 348.50px; height: 203.16px;"><img alt="" src="images/image5.png" style="width: 348.50px; height: 203.16px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 120.50px; height: 120.50px;"><img alt="" src="images/image2.png" style="width: 120.50px; height: 120.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></h2><h2 class="c29" id="h.s7rxkbxlqorz"><span class="c24 c33">First Step:</span><span class="c24"><br></span><span class="c42 c24 c47">Create a Google API console project and Client ID:</span><span class="c42 c24"><br></span><span class="c24 c45">Do this by going to </span><span class="c24 c27"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/web/sign-in&amp;sa=D&amp;ust=1524265158956000">https://developers.google.com/identity/sign-in/web/sign-in</a></span></h2><p class="c28"><span class="c6">Before you can integrate Google Sign-In into your website, you must create a client ID, which you need to call the sign-in API. </span></p><p class="c28 c20"><span class="c6"></span></p><p class="c51"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 439.50px; height: 242.10px;"><img alt="" src="images/image3.png" style="width: 439.50px; height: 242.10px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c28 c20"><span class="c6"></span></p><h2 class="c29" id="h.qi8qm2w3qq1g"><span class="c15">When you press next you will get to be here:<br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 565.50px; height: 248.71px;"><img alt="" src="images/image4.png" style="width: 565.50px; height: 248.71px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c52"><br></span><span class="c24 c33">Second Step:</span></h2><p class="c28"><span class="c24">The next tab asks you if you want to set this up for a Chrome App, or a web browser or web server or Ios App etc. You should choose web server because you would like to set up login always on the server side. Thinking way down the road you will realize that it&rsquo;s way much safer and efficient to do so. If you do client side login, you&rsquo;re thinking about getting all your database from the server and then use google&rsquo;s user information to do filtering on the client side to show only information that match your user details. This is risky and not safe as you don&rsquo;t want to get all user databases into the client side, rather using server side login where only matching data to your server only comes through is the safer and efficient way to go.<br><br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 423.50px; height: 322.84px;"><img alt="" src="images/image7.png" style="width: 423.50px; height: 322.84px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c24"><br><br>Your authorized redirect URIs is very important and should be set to where you&rsquo;re going to be running this. One might try to create two different OAuth Client, one for the localhost and one for the actual IP address. </span><span class="c42 c24">So, when you&rsquo;re working on login and not deploying set your Authorized redirect URIs to be <br><br></span><span class="c42 c24 c48">http://localhost:9000/</span><span class="c6"><br><br>Based on either localhost or you&rsquo;re IP address, You will get your own set of Client ID and Client Secret.</span></p><h2 class="c29" id="h.ie4qowphfddy"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 407.50px; height: 252.73px;"><img alt="" src="images/image6.png" style="width: 407.50px; height: 252.73px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></h2><p class="c28 c20"><span class="c6"></span></p><p class="c28"><span class="c15 c33">You can always change things on your API Console!<br><br></span><span class="c15">Also, Download the JSON file cause that&#39;s what we are going to store later rather than hard coding stuff.<br><br>Important: </span><span class="c10 c39 c23">ClientID is needed in 3 places: index.html, app.component.ts, and in client_secret_file.json</span></p><p class="c28 c20"><span class="c15 c13 c23"></span></p><p class="c28"><span class="c15">To use Google services on behalf of a user when the user is offline, you must use a hybrid server-side flow where a user authorizes your app on the client side using the JavaScript API client and you send a special one-time authorization code to your server. Your server exchanges this one-time-use code to acquire its own access and refresh tokens from Google for the server to be able to make its own API calls, which can be done while the user is offline. This one-time code flow has security advantages over both a pure server-side flow and over sending access tokens to your server. <br><br>Important: </span><span class="c10">The Google Sign-In server-side flow differs from the OAuth 2.0 for Web server applications flow.</span><span class="c15">&nbsp;<br><br>The sign-in flow for obtaining an access token for your server-side application is illustrated below. <br></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 459.50px; height: 372.89px;"><img alt="" src="images/image1.png" style="width: 459.50px; height: 372.89px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c15"><br>One-time codes have several security advantages. With codes, Google provides tokens directly to your server without any intermediaries.<br><br></span><span class="c15">&nbsp;</span><span class="c10 c23 c39">Keep your client secret secret!</span></p><p class="c28"><span class="c10"><br></span><span class="c15 c33">THE NEXT STEP IS ALL BASED ON </span><span class="c10"><br><br></span><span class="c10 c38"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/web/server-side-flow&amp;sa=D&amp;ust=1524265158960000">https://developers.google.com/identity/sign-in/web/server-side-flow</a></span><span class="c10"><br><br></span><span class="c15 c23 c33 c44">THIRD STEP:<br></span></p><p class="c28"><span class="c30 c24">Include the Google platform library on your page<br></span><span class="c12">Include the following scripts that demonstrate an anonymous function that inserts a script into the DOM of this </span><span class="c2">index.html</span><span class="c12 c13">&nbsp;web page.</span></p><p class="c7"><span class="c0 c13">&lt;!-- The top of file index.html --&gt;</span></p><p class="c7"><span class="c4">&lt;html</span><span class="c1">&nbsp;</span><span class="c5">itemscope</span><span class="c1">&nbsp;</span><span class="c5">itemtype</span><span class="c1">=</span><span class="c17">&quot;</span><span class="c24 c26"><a class="c3" href="https://www.google.com/url?q=http://schema.org/Article&amp;sa=D&amp;ust=1524265158961000">http://schema.org/Article</a></span><span class="c17">&quot;</span><span class="c4">&gt;<br>&lt;head&gt;<br></span><span class="c1">&nbsp; </span><span class="c0">&lt;!-- BEGIN Pre-requisites &rarr;<br></span><span class="c1">&nbsp; </span><span class="c4">&lt;script</span><span class="c1">&nbsp;</span><span class="c5">src</span><span class="c1">=</span><span class="c17">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&quot;</span><span class="c4">&gt;<br></span><span class="c1">&nbsp;</span><span class="c4">&lt;/script&gt;<br></span><span class="c1">&nbsp; </span><span class="c4">&lt;script</span><span class="c1">&nbsp;</span><span class="c5">src</span><span class="c1">=</span><span class="c17">&quot;https://apis.google.com/js/client:platform.js?onload=start&quot;</span><span class="c1">&nbsp;</span><span class="c5">async</span><span class="c1">&nbsp;</span><span class="c5">defer</span><span class="c4">&gt;<br></span><span class="c1">&nbsp; </span><span class="c4">&lt;/script&gt;<br></span><span class="c1">&nbsp; </span><span class="c0 c13">&lt;!-- END Pre-requisites --&gt;</span></p><h3 class="c18" id="h.lzcxkd7aviut"><span class="c24 c30">Initialize the GoogleAuth object<br></span><span class="c12">Load the auth2 library and call </span><span class="c15 c22">gapi.auth2.init()</span><span class="c12">&nbsp;to initialize the </span><span class="c15 c22">GoogleAuth</span><span class="c12">&nbsp;object. Specify your client ID and the scopes you want to request when you call </span><span class="c15 c22">init()</span><span class="c12 c13">.</span></h3><p class="c7"><span class="c8">&lt;!-- Continuing the &lt;head&gt; section &rarr;<br></span><span class="c14">&lt;script&gt;<br></span><span class="c2">&nbsp; &nbsp; </span><span class="c14">function</span><span class="c2">&nbsp;start() {<br> &nbsp; &nbsp; &nbsp;gapi.load(</span><span class="c24 c25">&#39;auth2&#39;</span><span class="c2">, </span><span class="c14">function</span><span class="c2">() {<br> &nbsp; &nbsp; &nbsp; &nbsp;auth2 = gapi.auth2.init({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client_id: </span><span class="c24 c25">&#39;YOUR_CLIENT_ID.apps.googleusercontent.com&#39;</span><span class="c2">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">// Scopes to request in addition to &#39;profile&#39; and &#39;email&#39;<br></span><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8">//scope: &#39;additional_scope&#39;<br></span><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; });<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;}|<br> &nbsp;</span><span class="c14">&lt;/script&gt;<br>&lt;/head&gt;<br>&lt;body&gt;</span><span class="c2">&nbsp; </span><span class="c8">&lt;!-- ... --&gt;</span><span class="c13 c14 c45">&lt;/body&gt;&lt;/html&gt;</span></p><h3 class="c18" id="h.3sc4w7j51m2t"><span class="c19">Add the sign-in button to your page</span></h3><p class="c7"><span class="c12">Add the sign-in button to your web page, and attach a click handler to call </span><span class="c42 c24 c37"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/web/reference%23googleauthgrantofflineaccessoptions&amp;sa=D&amp;ust=1524265158965000">grantOfflineAccess()</a></span><span class="c12 c13">&nbsp;to start the one-time-code flow.</span></p><p class="c7"><span class="c0">&lt;!-- Add where you want your sign-in button to render &rarr;<br>&lt;!-- Use an image that follows the branding guidelines in a real app &rarr;<br></span><span class="c4">&lt;button</span><span class="c1">&nbsp;</span><span class="c5">id</span><span class="c1">=</span><span class="c17">&quot;signinButton&quot;</span><span class="c4">&gt;</span><span class="c1">Sign in with Google</span><span class="c4">&lt;/button&gt;<br>&lt;script&gt;<br></span><span class="c1">&nbsp; $(</span><span class="c17">&#39;#signinButton&#39;</span><span class="c1">).click(</span><span class="c4">function</span><span class="c1">() {<br> &nbsp; &nbsp;</span><span class="c0">// signInCallback defined in step 6.<br></span><span class="c1">&nbsp; &nbsp; auth2.grantOfflineAccess().then(signInCallback);<br> &nbsp;});<br></span><span class="c4">&lt;/script&gt;</span></p><h3 class="c18" id="h.ekis20hh0u5q"><span class="c19">Send the authorization code to the server</span></h3><p class="c7"><span class="c12">The </span><span class="c2">code</span><span class="c12">&nbsp;is your one-time code that your server can exchange for its own access token and refresh token. You can only obtain a refresh token after the user has been presented an authorization dialog requesting offline access. You must store the refresh token that you retrieve for later use because subsequent exchanges will return </span><span class="c2">null</span><span class="c12 c13">&nbsp;for the refresh token. This flow provides increased security over your standard OAuth 2.0 flow.</span></p><p class="c7"><span class="c12 c13">Access tokens are always returned with the exchange of a valid authorization code.</span></p><p class="c7"><span class="c12">The following script defines a </span><span class="c10 c37"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/%23button_attr_callback&amp;sa=D&amp;ust=1524265158967000">callback</a></span><span class="c12 c13">&nbsp;function for the sign-in button. When a sign-in is successful, the function stores the access token for client-side use and sends the one-time code to your server on the same domain.</span></p><p class="c7"><span class="c0 c13">&lt;!-- Last part of BODY element in file index.html --&gt;</span></p><p class="c7"><span class="c4">&lt;script&gt;<br>function</span><span class="c1">&nbsp;signInCallback(authResult) {<br> &nbsp;</span><span class="c4">if</span><span class="c1">&nbsp;(authResult[</span><span class="c17">&#39;code&#39;</span><span class="c1">]) {<br></span><span class="c0">// Hide the sign-in button now that the user is authorized, for example:<br></span><span class="c1">&nbsp; &nbsp; $(</span><span class="c17">&#39;#signinButton&#39;</span><span class="c1">).attr(</span><span class="c17">&#39;style&#39;</span><span class="c1">, </span><span class="c17">&#39;display: none&#39;</span><span class="c1 c13">);</span></p><p class="c7"><span class="c1">&nbsp; &nbsp; </span><span class="c0">// Send the code to the server<br></span><span class="c1">$.ajax({<br> &nbsp; &nbsp; &nbsp;type: </span><span class="c17">&#39;POST&#39;</span><span class="c1">,<br> &nbsp; &nbsp; &nbsp;url: </span><span class="c17">&#39;</span><span class="c42 c26 c24"><a class="c3" href="https://www.google.com/url?q=http://example.com/storeauthcode&#39;,%257C&amp;sa=D&amp;ust=1524265158969000">http://example.com/storeauthcode&#39;,|</a></span><span class="c1"><br> &nbsp; &nbsp; &nbsp;</span><span class="c0">// Always include an `X-Requested-With` header in every AJAX request,<br></span><span class="c1">&nbsp; &nbsp; &nbsp; </span><span class="c0">// to protect against CSRF attacks.<br></span><span class="c1">&nbsp; &nbsp; &nbsp; headers: {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c17">&#39;X-Requested-With&#39;</span><span class="c1">: </span><span class="c17">&#39;XMLHttpRequest&#39;<br></span><span class="c1">&nbsp; &nbsp; &nbsp; },<br> &nbsp; &nbsp; &nbsp;contentType: </span><span class="c17">&#39;application/octet-stream; charset=utf-8&#39;</span><span class="c1">,<br> &nbsp; &nbsp; &nbsp;success: </span><span class="c4">function</span><span class="c1">(result) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c0">// Handle or verify the server response.<br></span><span class="c1">&nbsp; &nbsp; &nbsp; }, &nbsp; &nbsp; &nbsp;processData: </span><span class="c4">false</span><span class="c1">,<br>data: authResult[</span><span class="c17">&#39;code&#39;</span><span class="c1">]<br> &nbsp; &nbsp;});<br> &nbsp;} </span><span class="c4">else</span><span class="c1">&nbsp;{<br> &nbsp; &nbsp;</span><span class="c0">// There was an error.<br></span><span class="c1">&nbsp; }}<br></span><span class="c4 c13">&lt;/script&gt;</span></p><h3 class="c18" id="h.8nicw33wqyw8"><span class="c19">Exchange the authorization code for an access token</span></h3><p class="c7"><span class="c12 c13">On the server, exchange the auth code for access and refresh tokens. Use the access token to call Google APIs on behalf of the user and, optionally, store the refresh token to acquire a new access token when the access token expires.</span></p><p class="c7"><span class="c12 c13">If you requested profile access, you also get an ID token that contains basic profile information for the user.</span></p><p class="c7"><span class="c12">For example:</span></p><p class="c21"><span class="c0">// (Receive authCode via HTTPS POST)<br></span><span class="c4">if</span><span class="c1">&nbsp;(request.getHeader(</span><span class="c17">&#39;X-Requested-With&#39;</span><span class="c1">) == </span><span class="c4">null</span><span class="c1">) {<br> &nbsp;</span><span class="c0">// Without the `X-Requested-With` header, this request could be forged. Aborts.</span><span class="c1">} </span><span class="c0">// Set path to the Web application client_secret_*.json file you downloaded from the // Google API Console:<br></span><span class="c26 c24 c42"><a class="c3" href="https://www.google.com/url?q=https://console.developers.google.com/apis/credentials&amp;sa=D&amp;ust=1524265158972000">https://console.developers.google.com/apis/credentials</a></span><span class="c0 c13"><br>// You can also find your Web application client ID and client secret from the // console and specify them directly when you create the GoogleAuthorizationCodeTokenRequest // object.</span></p><p class="c21"><span class="c5">String</span><span class="c1">&nbsp;CLIENT_SECRET_FILE = </span><span class="c17">&quot;/path/to/client_secret.json&quot;</span><span class="c1">;<br></span><span class="c0">// Exchange auth code for access token<br></span><span class="c5">GoogleClientSecrets</span><span class="c1">&nbsp;clientSecrets =<br> &nbsp; &nbsp;</span><span class="c5">GoogleClientSecrets</span><span class="c1">.load(<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">JacksonFactory</span><span class="c1">.getDefaultInstance(), </span><span class="c4">new</span><span class="c1"><br></span><span class="c5">FileReader</span><span class="c1">(CLIENT_SECRET_FILE));<br></span><span class="c5">GoogleTokenResponse</span><span class="c1">&nbsp;tokenResponse =<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c4">new</span><span class="c1">&nbsp;</span><span class="c5">GoogleAuthorizationCodeTokenRequest</span><span class="c1">(<br></span><span class="c4">new</span><span class="c1">&nbsp;</span><span class="c5">NetHttpTransport</span><span class="c1">(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">JacksonFactory</span><span class="c1">.getDefaultInstance(), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c17">&quot;</span><span class="c42 c26 c24"><a class="c3" href="https://www.google.com/url?q=https://www.googleapis.com/oauth2/v4/token&amp;sa=D&amp;ust=1524265158974000">https://www.googleapis.com/oauth2/v4/token</a></span><span class="c17">&quot;</span><span class="c1 c13">,<br>clientSecrets.getDetails().getClientId(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clientSecrets.getDetails().getClientSecret(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authCode,</span></p><p class="c21"><span class="c1 c13">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REDIRECT_URI) &nbsp;</span></p><p class="c21"><span class="c0">// Specify the same redirect URI that you use with your web</span><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c0">// app. If you don&#39;t have a web version of your app, you can</span><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">// specify an empty string.<br></span><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.execute();<br></span><span class="c5">String</span><span class="c1">&nbsp;accessToken = tokenResponse.getAccessToken();<br></span><span class="c0 c13">// Use access token to call API</span></p><p class="c21"><span class="c5">GoogleCredential</span><span class="c1">&nbsp;credential = </span><span class="c4">new</span><span class="c1">&nbsp;</span><span class="c5">GoogleCredential</span><span class="c1 c13">().setAccessToken(accessToken);</span></p><p class="c21"><span class="c5">Drive</span><span class="c1 c13">&nbsp;drive =</span></p><p class="c21"><span class="c1">&nbsp; &nbsp; </span><span class="c4">new</span><span class="c1">&nbsp;</span><span class="c5">Drive</span><span class="c1">.</span><span class="c5">Builder</span><span class="c1">(</span><span class="c4">new</span><span class="c1">&nbsp;</span><span class="c5">NetHttpTransport</span><span class="c1">(), </span><span class="c5">JacksonFactory</span><span class="c1 c13">.getDefaultInstance(), credential)</span></p><p class="c21"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; .setApplicationName(</span><span class="c17">&quot;Auth Code Exchange Demo&quot;</span><span class="c1 c13">)</span></p><p class="c21"><span class="c1 c13">&nbsp; &nbsp; &nbsp; &nbsp; .build();</span></p><p class="c21"><span class="c5">File</span><span class="c1">&nbsp;file = drive.files().</span><span class="c4">get</span><span class="c1">(</span><span class="c17">&quot;appfolder&quot;</span><span class="c1 c13">).execute();</span></p><p class="c21"><span class="c0 c13">// Get profile info from ID token</span></p><p class="c21"><span class="c5">GoogleIdToken</span><span class="c1">&nbsp;idToken = tokenResponse.parseIdToken();<br></span><span class="c5">GoogleIdToken</span><span class="c1">.</span><span class="c5">Payload</span><span class="c1">&nbsp;payload = idToken.getPayload();<br></span><span class="c5 c42">String</span><span class="c1 c42">&nbsp;userId = payload.getSubject(); </span><span class="c1"><br> </span><span class="c0">// Use this value as a key to identify a user.<br></span><span class="c5">String</span><span class="c1">&nbsp;email = payload.getEmail();<br></span><span class="c4">boolean</span><span class="c1">&nbsp;emailVerified = </span><span class="c5">Boolean</span><span class="c1">.valueOf(payload.getEmailVerified());<br></span><span class="c5">String</span><span class="c1">&nbsp;name = (</span><span class="c5">String</span><span class="c1">) payload.</span><span class="c4">get</span><span class="c1">(</span><span class="c17">&quot;name&quot;</span><span class="c1">);<br></span><span class="c5">String</span><span class="c1">&nbsp;pictureUrl = (</span><span class="c5">String</span><span class="c1">) payload.</span><span class="c4">get</span><span class="c1">(</span><span class="c17">&quot;picture&quot;</span><span class="c1">);<br></span><span class="c5">String</span><span class="c1">&nbsp;locale = (</span><span class="c5">String</span><span class="c1">) payload.</span><span class="c4">get</span><span class="c1">(</span><span class="c17">&quot;locale&quot;</span><span class="c1">);<br></span><span class="c5">String</span><span class="c1">&nbsp;familyName = (</span><span class="c5">String</span><span class="c1">) payload.</span><span class="c4">get</span><span class="c1">(</span><span class="c17">&quot;family_name&quot;</span><span class="c1">);<br></span><span class="c5">String</span><span class="c1">&nbsp;givenName = (</span><span class="c5">String</span><span class="c1">) payload.</span><span class="c4">get</span><span class="c1">(</span><span class="c17">&quot;given_name&quot;</span><span class="c1 c13">);</span></p><p class="c16"><span class="c1 c13"></span></p><h2 class="c29" id="h.44bpkl80vojz"><span class="c24 c33">Fourth Step:</span></h2><p class="c7"><span class="c15">Then use specific ID tokens to make a new collection. For instance, we chose the getSubject which is unique to each user to link up to all our different collection.<br><br>Our user collection in the database consisted of 4 different fields:<br><br>User Collection:<br>_id = MongoDB based auto generated unique object ID<br>subjectID = The one we import from the Gapi Client<br>(</span><span class="c10 c32">String</span><span class="c10 c22">&nbsp;userId = payload.getSubject)</span><span class="c15 c13 c23"><br>FirstName = User Given name from the Gapi Client<br>LastName = User Last name from the Gapi client</span></p><p class="c7"><span class="c15 c13 c23">We then used filtering on all the different collections in the server controller and handler through adding one more field to the collection which is userID. <br><br>UserID is basically the _id objectID we gave that was generated from the subjectID we imported from the Gapi Client.</span></p><p class="c7"><span class="c15">We do this in the server java file:<br>This is the code that makes the import and adds those variables from Gapi client into the Usercontroller for the UserCollection<br><br></span><span class="c11 c8">JSONObject obj = new JSONObject(req.body());<br>String authCode = obj.getString(&quot;code&quot;);</span></p><p class="c7"><span class="c11 c8">try {</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;// We can create this later to keep our secret safe</span></p><p class="c7"><span class="c8 c43">&nbsp; &nbsp;String CLIENT_SECRET_FILE = &quot;./src/main/java/umm3601/server_files/client_secret_file.json&quot;; <br></span><span class="c24 c34"><br></span><span class="c15 c13 c41">You can hide your json file and then call it out like this^</span></p><p class="c7"><span class="c24 c41 c46">&nbsp; &nbsp;</span><span class="c11 c8">GoogleClientSecrets clientSecrets =</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; GoogleClientSecrets.load(</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;JacksonFactory.getDefaultInstance(), new FileReader(CLIENT_SECRET_FILE));</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;GoogleTokenResponse tokenResponse =</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp;new GoogleAuthorizationCodeTokenRequest(</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;new NetHttpTransport(),</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;JacksonFactory.getDefaultInstance(),</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;https://www.googleapis.com/oauth2/v4/token&quot;,</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clientSecrets.getDetails().getClientId(),</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Replace clientSecret with the localhost one if testing</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clientSecrets.getDetails().getClientSecret(),</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authCode,</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;http://localhost:9000&quot;)</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Not sure if we have a redirectUri</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Specify the same redirect URI that you use with your web</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// app. If you don&#39;t have a web version of your app, you can</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// specify an empty string.</span></p><p class="c7"><span class="c8 c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.execute();</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;GoogleIdToken idToken = tokenResponse.parseIdToken();</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;GoogleIdToken.Payload payload = idToken.getPayload();</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String subjectId = payload.getSubject(); &nbsp;// Use this value as a key to identify a user.</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String email = payload.getEmail();</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;boolean emailVerified = Boolean.valueOf(payload.getEmailVerified());</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String name = (String) payload.get(&quot;name&quot;);</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String pictureUrl = (String) payload.get(&quot;picture&quot;);</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String locale = (String) payload.get(&quot;locale&quot;);</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String familyName = (String) payload.get(&quot;family_name&quot;);</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;String givenName = (String) payload.get(&quot;given_name&quot;);</span></p><p class="c7"><span class="c11 c8">&nbsp; &nbsp;return userController.addNewUser(subjectId, givenName, familyName);</span></p><p class="c7"><span class="c15 c13 c23"><br><br>We filter through our given generated _id/UserID rather than the subjectID in all of the other collection for an extra layer of protection. Now the Client side will only consists of collections with an object ID which is unique to the app and not give out Google Subject ID to hack other form of data. </span></p><p class="c7"><span class="c15 c13 c23">For instance,</span></p><p class="c7"><span class="c15 c13 c23">Journaling Collection:<br>$oid(for that specific journal), subject, body, date and userID(from user collection)<br></span></p><p class="c7"><span class="c15 c13 c23">Goals Collection:<br>$oid(for that specific goal), purpose, category, name, status, start, end, next, frequency and userID(from user collection)</span></p><p class="c7"><span class="c15 c13 c23"><br>Emotions Collection:<br>$oid(for that specific Emotion), mood, intensity, date and userID (from user collection) &nbsp;</span></p><p class="c7"><span class="c15"><br>References:<br></span><span class="c10 c38"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/web/server-side-flow&amp;sa=D&amp;ust=1524265158987000">https://developers.google.com/identity/sign-in/web/server-side-flow</a></span></p><p class="c7"><span class="c10 c38"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/web/backend-auth&amp;sa=D&amp;ust=1524265158988000">https://developers.google.com/identity/sign-in/web/backend-auth</a></span></p><p class="c7"><span class="c10 c38"><a class="c3" href="https://www.google.com/url?q=https://developers.google.com/identity/sign-in/web/people&amp;sa=D&amp;ust=1524265158988000">https://developers.google.com/identity/sign-in/web/people</a></span></p><p class="c7 c20"><span class="c15 c13 c23"></span></p><p class="c35"><span class="c15 c13 c23">For more questions contact @xaiteev, @CMenne, @ahnafy</span></p><p class="c35"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 164.50px; height: 164.50px;"><img alt="" src="images/image2.png" style="width: 164.50px; height: 164.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></body></html>